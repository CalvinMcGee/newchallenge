box: debian
build:
  steps:
    - arjen/hugo-build@1.29.1:
        version: "0.14"
        config: "config.yaml"
    - arjen/hugo-build@1.29.1:
        version: "0.14"
        config: "dev.yaml"
dev:
  steps:
    - install-packages:
        packages: git
    - lukevivier/gh-pages@0.2.1:
        token: $GIT_TOKEN
        basedir: public_dev
production:
  steps:
    - hikaruhorie/install-aws-cli:
        key: $AWS_ACCESS_KEY_ID
        secret: $AWS_SECRET_ACCESS_KEY
        region: $AWS_REGION
    - script:
        name: AWS Sync
        code: |-
          aws s3 sync --exclude '*.*' --include '*.css' --content-type 'text/css' --cache-control 'max-age=604800' --size-only ${WERCKER_SOURCE_DIR}/public/ $AWS_BUCKET_URL
          aws s3 sync --exclude '*.*' --include '*.js' --content-type 'application/javascript' --cache-control 'max-age=604800' --size-only ${WERCKER_SOURCE_DIR}/public/ $AWS_BUCKET_URL
          aws s3 sync --exclude '*.*' --include '*.png' --include '*.jpg' --include '*.ico' --expires 'Sat, 20 Nov 2020 18:46:39 GMT' --cache-control 'max-age=604800' --size-only ${WERCKER_SOURCE_DIR}/public/ $AWS_BUCKET_URL
          aws s3 sync --exclude '*.*' --include '*.html' --content-type 'text/html' --cache-control 'max-age=7200, must-revalidate' --size-only ${WERCKER_SOURCE_DIR}/public/ $AWS_BUCKET_URL
          aws s3 sync --delete --size-only ${WERCKER_SOURCE_DIR}/public/ $AWS_BUCKET_URL
